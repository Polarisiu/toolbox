#!/bin/bash
# ==========================================
# ç³»ç»Ÿå¿«ç…§å¤‡ä»½å·¥å…· å¸è½½è„šæœ¬
# ==========================================

RED="\033[31m"
GREEN="\033[32m"
YELLOW="\033[33m"
RESET="\033[0m"

echo -e "${YELLOW}ğŸ—‘ å¼€å§‹å¸è½½ç³»ç»Ÿå¿«ç…§å¤‡ä»½å·¥å…·...${RESET}"

# åœæ­¢å¹¶ç¦ç”¨ systemd æœåŠ¡å’Œå®šæ—¶å™¨
systemctl stop system-snapshot.timer 2>/dev/null
systemctl disable system-snapshot.timer 2>/dev/null
systemctl stop system-snapshot.service 2>/dev/null
systemctl disable system-snapshot.service 2>/dev/null

# åˆ é™¤ systemd é…ç½®æ–‡ä»¶
rm -f /etc/systemd/system/system-snapshot.service
rm -f /etc/systemd/system/system-snapshot.timer
systemctl daemon-reload
systemctl reset-failed

# åˆ é™¤ä¸»è„šæœ¬å’Œé…ç½®æ–‡ä»¶
rm -f /root/system_snapshot.sh
rm -f /root/snapshot_config.conf

# åˆ é™¤æ—¥å¿—æ–‡ä»¶
rm -f /root/snapshot_log.log
rm -f /root/snapshot_debug.log
rm -f /root/snapshot_install.log

# åˆ é™¤æœ¬åœ°å¤‡ä»½ç›®å½•ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
if [ -d "/backups" ]; then
    echo -e "${YELLOW}æ˜¯å¦åˆ é™¤æœ¬åœ°å¤‡ä»½ç›®å½• /backups ? (y/N)${RESET}"
    read -r CONFIRM
    if [[ "$CONFIRM" =~ ^[Yy]$ ]]; then
        rm -rf /backups
        echo -e "${GREEN}âœ“ å·²åˆ é™¤ /backups${RESET}"
    else
        echo -e "${YELLOW}âš  å·²ä¿ç•™ /backups${RESET}"
    fi
fi

# åˆ é™¤ SSH keyï¼ˆå¦‚æœæ˜¯ä¸“é—¨ç”Ÿæˆçš„ï¼‰
if [ -f "/root/.ssh/id_rsa" ] && grep -q "Generated by snapshot tool" /root/.ssh/id_rsa.pub 2>/dev/null; then
    echo -e "${YELLOW}æ˜¯å¦åˆ é™¤ /root/.ssh/id_rsa (ç”¨äºå¿«ç…§å·¥å…·çš„ SSH key)? (y/N)${RESET}"
    read -r CONFIRM_KEY
    if [[ "$CONFIRM_KEY" =~ ^[Yy]$ ]]; then
        rm -f /root/.ssh/id_rsa /root/.ssh/id_rsa.pub
        echo -e "${GREEN}âœ“ å·²åˆ é™¤ SSH key${RESET}"
    else
        echo -e "${YELLOW}âš  å·²ä¿ç•™ SSH key${RESET}"
    fi
fi

echo -e "${GREEN}âœ… ç³»ç»Ÿå¿«ç…§å¤‡ä»½å·¥å…·å·²å¸è½½å®Œæˆ${RESET}"
